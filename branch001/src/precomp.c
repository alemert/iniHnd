/******************************************************************************/
/* ini file handler - ini file reader                                         */
/*                                                                            */
/* functions:                                                                 */
/******************************************************************************/

/******************************************************************************/
/*   I N C L U D E S                                                          */
/******************************************************************************/

// ---------------------------------------------------------
// system
// ---------------------------------------------------------
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ---------------------------------------------------------
// own 
// ---------------------------------------------------------
#include <initypes.h>
#include <inihnd.h>

#include <msgcat/lgstd.h>
#include <ctl.h>

#include <genlib.h>

/******************************************************************************/
/*   G L O B A L S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   D E F I N E S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   M A C R O S                                                              */
/******************************************************************************/

/******************************************************************************/
/*   P R O T O T Y P E S                                                      */
/******************************************************************************/

/******************************************************************************/
/*                                                                            */
/*   F U N C T I O N S                                                        */
/*                                                                            */
/******************************************************************************/

/******************************************************************************/
/******************************************************************************/
char* precompile( const char* inMem, int *sysRc )
{
  char *outMem = NULL ;

  char *pIn ;
  char *pOut ;

  int inLen  = strlen( inMem ) ;
  int outLen = 2 * countChar( inMem, '=' ) + inLen ;

  int copyFlag  ;
  int quoteFlag ;

  outMem = (char*) malloc( (outLen+1) * sizeof(char) ) ;
  if( outMem == NULL )
  {
    logger( LSTD_MEM_ALLOC_ERROR ) ;
    goto _door ;
  }
 
  outMem[outLen] = '\0' ;

  pIn  = (char*) inMem  ;
  pOut = outMem ;

  quoteFlag = 0 ;

  while( *pIn != '\0' )
  {
    copyFlag = 0 ;
    switch( *pIn )
    {
      case ' '  : 
      case '\t' : 
      case '\n' : 
      {
        break ;
      }
      case '"'  :
      {
        quoteFlag = quoteFlag ?  0 : 1 ;
        copyFlag  = 1 ;
        break ;
      }
      default    :
      {
        copyFlag = 1 ;
        break ;
      }
    }
    if( quoteFlag ) copyFlag = 1 ;
    if( copyFlag  )
    {
      *pOut = *pIn ;
      pOut++ ;
    }
    pIn++ ;
  } 

  sysRc = 0 ;

_door :

  return outMem ;

}

/******************************************************************************/
/******************************************************************************/
int countChar( const char* mem, char c )
{
  char *p  = mem ;
  int  cnt = 0   ;

  while( *p != '\0' )
  {
    if( *p == c ) cnt++ ;
    p++ ;
  }

  return cnt ;
}

